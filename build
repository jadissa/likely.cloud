#!/bin/bash


#
# Get dependencies
#
sudo yum -y update

sudo yum -y install wget libicu-dev epel-release

wget --directory-prefix=/tmp/ https://nodejs.org/dist/v7.10.0/node-v7.10.0.tar.xz

mkdir /tmp/node-v7.10.0

tar -xvf /tmp/node-v7.10.0.tar.xz -C /tmp/node-v7.10.0

/tmp/node-v7.10.0/./configure --download=all

/tmp/node-v7.10.0/make 

/tmp/node-v7.10.0/make install /tmp/node-v7.10.0/

which node

node -v


#
# Install Composer
#
echo "Installing Composer..."

curl -sS https://getcomposer.org/installer | php -- --install-dir=.


#
# Update Composer and install dependencies
#
echo "Updating Composer..."

echo 'export PATH=/var/www/html:$PATH' >>/home/jadii/.bashrc

source /home/jadii/.bashrc

echo "Running Composer..."

php composer.phar -V

php composer.phar -v install


#
# Install one-off dependencies that don't use composer 
#
git clone git@github.com:dreamloud/discord-token-generator.git vendor/discord-token-generator

cd vendor/discord-token-generator

npm install



#
# Run node
#
forever start server.js 

forever list


#
# Head back to project root
#
cd ../..


#
# Install mongodb
#
npm install 

cd tests

node create_mongodb.js