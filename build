#!/bin/bash
#https://www.digitalocean.com/community/tutorials/how-to-set-up-a-node-js-application-for-production-on-centos-7

#
# Get dependencies
#
cd ~

sudo yum -y update

sudo yum -y install wget libicu-dev epel-release git vim 

sudo yum -y groupinstall 'Development Tools'

sudo yum -y install gcc-c++ make

sudo curl -sL https://rpm.nodesource.com/setup_8.x | sudo -E bash -

sudo yum install -y nodejs

which node

node -v

npm -v


#
# Setting up web root
#
mkdir -p /var/www/html

cd /var/www/html

echo 'export PATH=/var/www/html:$PATH' >>~/.bashrc

source ~/.bashrc

curl -w "\n" http://169.254.169.254/metadata/v1/interfaces/private/0/ipv4/address


##
## Install Composer
##
#cd /var/www/html/

#echo "Installing Composer..."

#curl -sS https://getcomposer.org/installer | php -- --install-dir=.


##
## Update Composer and install dependencies
#
#echo "Updating Composer..."

#USER=`whoami`

#echo "Running Composer..."

#php composer.phar -V

#php composer.phar -v install

#
# Test node
#
node start tests/server.js &


#
# Install one-off dependencies that don't use composer 
#
git clone git@github.com:dreamloud/discord-token-generator.git vendor/discord-token-generator

cd vendor/discord-token-generator

npm install


#
# Globally nstall react for UI
#
sudo /usr/local/node-v7.10.0-linux-x64/bin/npm install -g react-composer create-react-app

create-react-app app

#
# Run node
#
forever start server.js 

forever list


##
## Head back to project root
##
#cd ../..


##
## Install mongodb
##
#npm install 

## https://www.digitalocean.com/community/tutorials/how-to-install-mongodb-on-centos-7
#sudo yum -y install mongodb-org

#sudo systemctl start mongod

#cd tests

#node create_mongodb.js

#npm install mongoose --save

#npm install body-parser --save


##
## Configure mongodb
##
#mongod --port 27017 --dbpath /var/lib/mongo

#sudo systemctl start mongod


#use likelycloud


